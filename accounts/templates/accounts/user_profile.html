{% extends 'main.html' %} {% load static %} {% block content %}
<div class="p-8 w-full max-w-7xl mx-auto flex flex-col justify-between gap-6">
  <div class="flex justify-between">
    <div
      class="bg-teal-900 py-2 px-4 rounded-full flex items-center text-white gap-4"
    >
      <a
        id="back-button"
        class="px-2 py-1 font-bold hover:bg-yellow-200 hover:text-black rounded-full transition-all duration-300"
        href="#"
        >&larr;</a
      >
      Retourner
    </div>
    <span
      class="flex items-center gap-4 py-2 px-4 rounded-full bg-yellow-200 text-black"
      ><i class="fa-solid fa-user"></i> Mon profil</span
    >
  </div>

  <section class="flex flex-col gap-4">
    <!--------------------------------------- menu tabs buttons --------------------------------------->
    <div
      class="flex justify-between gap-2 text-xs tabbar h-fit w-full max-w-80 lg:max-w-[500px] p-2 bg-teal-900 rounded-full"
    >
      <button
        class="tabBtn px-4 py-2 bg-white hover:bg-teal-900 hover:text-white rounded-full w-full"
        onclick="openTab(event, 'cart')"
        id="defaultTab"
      >
        <i class="fa-solid fa-shopping-cart"></i>
        <span class="ml-2">Panier</span>
      </button>
      <button
        class="tabBtn px-4 py-2 bg-white hover:bg-teal-900 hover:text-white rounded-full w-full"
        onclick="openTab(event, 'orders')"
      >
        <i class="fa-solid fa-dolly"></i>
        <span class="ml-2">Commandes</span>
      </button>
      <button
        class="tabBtn px-4 py-2 bg-white hover:bg-teal-900 hover:text-white rounded-full w-full"
        onclick="openTab(event, 'deliveries')"
      >
        <i class="fa-solid fa-truck"></i>
        <span class="ml-2">Livraisons</span>
      </button>
    </div>

    <div id="cart" class="tabcontent w-full flex flex-col gap-2">
      {% if cart_count == 0 %}
      <div class="flex flex-col items-center gap-2 my-20 mx-auto">
        <i class="fa-solid fa-shopping-cart text-teal-900 text-9xl"></i>
        <span>Votre panier est vide</span>
        <a
          href="{% url 'products' %}"
          class="bg-yellow-200 rounded-full py-2 px-4 flex items-center gap-4 group"
          >Parcourir le catalogue
          <span
            class="bg-yellow-200 rounded-full py-2 px-3 group-hover:bg-teal-900 group-hover:text-white"
            >&rarr;</span
          ></a
        >
      </div>
      {% else %}
      <!-- cart overview -->
      <div
        class="bg-gray-100 border p-2 rounded-full flex justify-between items-center gap-4"
      >
        <span>Articles : {{ cart_items|length }}</span>
        <span>Quantité : {{ cart_count }}</span>
        <span>Total : {{ total_price }} F/CFA</span>
        <div
          class="bg-teal-900 py-2 px-4 rounded-full flex items-center text-white gap-4"
        >
          Placer ma commande
          <a
            href="{% url 'checkout' %}"
            class="inline-block px-2 py-1 font-bold hover:bg-yellow-200 hover:text-black rounded-full"
            >&rarr;</a
          >
        </div>
      </div>
      <!-- cart details -->
      <div class="overflow-x-auto overflow-y-hidden rounded-xl">
        <table id="visits_table" class="w-full text-left db-table">
          <thead
            class="bg-teal-900 border border-teal-900 bg-teal-900 text-white"
          >
            <tr>
              <th class="px-3 py-4 text-sm">Image</th>
              <th class="px-3 py-4 text-sm">Article</th>
              <th class="px-3 py-4 text-sm">Prix</th>
              <th class="px-3 py-4 text-sm text-center">Quantité</th>
              <th class="px-3 py-4 text-sm">Total</th>
              <th class="px-3 py-4 text-sm text-center">Actions</th>
            </tr>
          </thead>

          <tbody class="border">
            {% for item in cart_items %}
            <tr
              class="text-gray-600 border text-sm hover:bg-white hover:text-black transition-all duration-50"
            >
              <td class="px-3 py-1">
                <img
                  class="h-10 text-gray-200"
                  src="{{item.product.image.url}}"
                  alt="item image"
                />
              </td>
              <td class="px-3 py-1">{{item.product.name}}</td>
              {% if item.product.is_promoted %}
              <td class="px-3 py-1">{{item.product.promo_price}}</td>
              {% else %}
              <td class="px-3 py-1">{{item.product.price}}</td>
              {% endif %}
              <td class="px-3 py-1 text-center">{{item.quantity}}</td>
              <td class="px-3 py-1">{{item.total_price}} Cfa</td>
            </tr>
            <input type="hidden" id="csrf_token" value="{{ csrf_token }}" />
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
    </div>
  </section>
</div>

<script>
  document
    .getElementById("back-button")
    .addEventListener("click", function (event) {
      event.preventDefault(); // Prevent the default anchor behavior
      window.history.go(-1); // Go back two pages
    });

      //  tabs control ----------------------------------------------------------------------------------------------------
  document.getElementById("defaultTab").click();
  function openTab(event, tabName) {
    var i, tabcontent, tabBtn;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tabBtn = document.getElementsByClassName("tabBtn");
    for (i = 0; i < tabBtn.length; i++) {
      tabBtn[i].className = tabBtn[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    event.currentTarget.className += " active";
    var minitabs = document.getElementsByClassName("minitabcontent");
    if (minitabs.length != 0) {
      minitabs = tabcontent.children;
    }
  }
</script>
{% endblock %}
