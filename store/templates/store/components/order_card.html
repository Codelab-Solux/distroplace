{% load static %}

<div
  class="py-2 px-4 w-full bg-white hover:bg-gray-100 text-xs flex justify-between items-center rounded-full border hover:shadow-lg transition duration-200 ease-in"
>
  <h3 class="font-bold text-black">Commande NÂ°{{obj.id}}</h3>
  <p>
    <i class="fa-solid fa-money-bill mr-2"></i>
    {{obj.amount}} CFA
  </p>
  <p>
    <i class="fa-solid fa-calendar-days mr-2"></i>
    {{obj.timestamp.date}}
  </p>
  <p>
    <i class="fa-solid fa-clock mr-2"></i>
    {{obj.timestamp.time}}
  </p>

  {% include 'store/components/order_status.html' %}
  <!--  -->

  <div class="relative text-gray-700">
    <button
      type="button"
      class="hover:text-black bg-white hover:text-teal-700 px-3 py-1 rounded-full"
      name="orderSentry"
      id="orderSentry"
      aria-expanded="false"
      aria-haspopup="true"
      onclick="toggleHostActionDropdown(this,'{{obj.id}}')"
    >
      <i class="fa-sharp fa-solid fa-ellipsis-vertical"></i>
    </button>

    <div
      class="hidden bg-gray-50 w-40 shadow-md lg:w-[180px] p-2 absolute right-0 top-12 origin-top-left bg-white z-10 rounded-lg flex flex-col items-center gap-2 text-xs lg:text-sm overflow-hidden"
      role="status menu"
      aria-orientation="vertical"
      aria-labelledby="status-menu-button"
      tabindex="-1"
      id="actionMenu{{obj.id}}"
    >
      {% if obj.client == user and obj.status == 'pending' %}
      <button
        hx-post="{% url 'product_details' obj.id %}"
        hx-target=".obj_status{{obj.id}}, .order_details"
        hx-swapp="innerHTML"
        onclick="close_modal()"
        class="p-2 flex items-center hover:text-black hover:bg-red-200 rounded-md w-full text-center {% if obj.status.id > 1 %} cursor-none pointer-events-none opacity-50 disabled {% endif %}"
      >
        <i class="text-sm fa-solid fa-ban mr-2"></i>
        Annuler
      </button>
      {% endif %}

      {% if user.is_staff and obj.status == 'pending' %}
      <button
        hx-post="{% url 'product_details' obj.id  %}"
        hx-target=".obj_status{{obj.id}}, .order_details"
        hx-swapp="innerHTML"
        onclick="close_modal()"
        class="p-2 flex items-center hover:text-black hover:bg-yellow-200 rounded-md w-full text-center {% if obj.status.id > 2 %} cursor-none pointer-events-none opacity-50 disabled {% endif %}"
      >
        <i class="text-sm fa-solid fa-check mr-2"></i>
        Traiter
      </button>
      <!--  -->
      {% endif %}
    </div>
  </div>
</div>

  <script>
    function toggleHostActionDropdown(e, obj_id) {
      activeMenu = document.getElementById(`actionMenu${obj_id}`);
      e.name === `orderSentry`
        ? ((e.name = "close"), activeMenu.classList.remove("hidden"))
        : ((e.name = `orderSentry`), activeMenu.classList.add("hidden"));
    }

    window.addEventListener("mouseup", function (event) {
      activeMenu.classList.add("hidden");
    });
  </script>
