{% load static %}
<nav
  class="bg-teal-900 text-white w-[60px] md:w-20 p-2 md:p-4 xl:w-[300px] min-h-screen fixed overflow-y-auto"
>
  <a class="mb-4 flex items-center" href="{% url 'home' %}" hx-boost="false">
    <img
      class="h-6 xl:h-10 mx-auto xl:mx-0 xl:mr-2"
      src="{% static 'imgs/logo-w.png' %}"
      alt="logo"
    />
    <h1 class="hidden xl:inline text-xl font-black">Distroplace</h1>
  </a>

  <ul
    class="h-[calc(100vh-70px)] w-full flex flex-col gap-0 mx-auto items-center xl:items-start"
  >
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dashboard}}"
      href="{% url 'dashboard' %}"
    >
      <i class="fa-solid fa-chart-pie xl:mr-2"></i>
      <span class="hidden xl:inline"> Tableau de bord </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_products}}"
      href="{% url 'dash_products' %}"
    >
      <i class="fa-solid fa-boxes-stacked xl:mr-2"></i>
      <span class="hidden xl:inline"> Produits </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_orders}}"
      href="{% url 'dash_orders' %}"
    >
      <i class="fa-solid fa-dolly xl:mr-2"></i>
      <span class="hidden xl:inline"> Commandes </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_deliveries}}"
      href="{% url 'dash_deliveries' %}"
    >
      <i class="fa-solid fa-truck xl:mr-2"></i>
      <span class="hidden xl:inline"> Livraisons </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{promos}}"
      href="{% url 'promos' %}"
    >
      <i class="fa-solid fa-tags xl:mr-2"></i>
      <span class="hidden xl:inline"> Promotions </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{clients_page}}"
      href="{% url 'clients' %}"
    >
      <i class="fa-solid fa-users xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Clients </span>
    </a>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{suppliers_page}}"
      href="{% url 'suppliers' %}"
    >
      <i class="fa-solid fa-boxes-packing xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Fournisseurs </span>
    </a>
    {% if user.role.sec_level > 3 %}
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{staff_page}}"
      href="{% url 'staff' %}"
    >
      <i class="fa-solid fa-user-tie xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Personnel </span>
    </a>
    {% endif %}
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_blog_page}}"
      href="{% url 'dash_blog' %}"
    >
      <i class="fa-solid fa-blog xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Blog </span>
    </a>
    <div class="my-1 flex flex-col w-full">
      <button
        name="optionsBtn"
        onclick="toggleOptions(this,'comm_options')"
        class="px-1 xl:px-3 py-2 flex justify-between items-center text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_comms_page}}"
      >
        <div class="flex">
          <i class="fa-solid fa-people-arrows xl:mr-2 text-sm"></i>
          <span class="hidden xl:inline"> Communications </span>
        </div>

        <i id="comm_options_caret" class="fa-sharp fa-solid fa-caret-down"></i>
      </button>
      <div
        class="w-full xl:p-2 hidden bg-teal-700 text-gray-200 rounded-xl grid gap-2 overflow-hidden"
        role="menu"
        aria-orientation="vertical"
        aria-labelledby="user-menu-button"
        id="comm_options"
      >
        <a
          href="{% url 'dash_feedbacks' %}"
          class="px-3 py-2 flex text-sm hover:text-black hover:bg-teal-200 xl:rounded-full w-full transition ease-in duration-200"
        >
          <i class="fa-solid fa-comment-dots xl:mr-2 text-sm"></i>
          <span class="hidden xl:inline">Feedbacks</span>
        </a>

        <a
          href="{% url 'contact_mails' %}"
          class="px-3 py-2 flex text-sm hover:text-black hover:bg-teal-200 xl:rounded-full w-full transition ease-in duration-200"
        >
          <i class="fa-solid fa-envelopes-bulk xl:mr-2 text-sm"></i>
          <span class="hidden xl:inline">Courriers</span>
        </a>
      </div>
    </div>
    <a
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-white hover:text-black transition ease-in duration-200 w-full {{dash_parameters}}"
      href="{% url 'dash_parameters' %}"
    >
      <i class="fa-solid fa-gears xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Parametres </span>
    </a>
    <!--  -->
    {% if user.is_superuser %}
    <a
      target="_blank"
      class="px-1 xl:px-3 py-2 text-center xl:text-left rounded-full hover:bg-teal-950 hover:text-white transition ease-in duration-200 w-full"
      href="{% url 'admin:index' %}"
      ><i class="fa-solid fa-lock xl:mr-2 text-sm"></i>
      <span class="hidden xl:inline"> Admin Dashboard </span>
    </a>
    {% endif %}
    <div
      class="w-full px-1 py-2 xl:p-2 flex flex-col xl:flex-row items-center gap-1 xl:gap-2 mb-2 xl:bg-white sm:text-sm xl:text-md rounded-full cursor-pointer"
    >
      {% if not user.profile.image %}
      <img
        class="hidden xl:inline h-10 w-10 rounded-md object-cover"
        src="{% static 'imgs/anon.png' %}"
        alt="welcome image"
      />
      {% else %}
      <img
        class="hidden xl:block h-10 w-10 rounded-md object-cover"
        src="{{user.profile.image.url}}"
        alt="welcome image"
      />
      {% endif %}
      <div class="hidden xl:block w-full">
        <p class="text-black font-bold">
          {{user.last_name|title}} {{user.first_name|title}}
        </p>
        <p class="text-gray-500">@{{user.username}}</p>
      </div>
      <div class="relative">
        <button
          type="button"
          class="bg-white hover:bg-yellow-200 text-gray-500 hover:text-black px-4 py-2 rounded-full"
          name="optionsBtn"
          aria-expanded="false"
          aria-haspopup="true"
          onclick="toggleOptions(this,'account_options')"
        >
          <i
            id="account_options_caret"
            class="fa-sharp fa-solid fa-caret-down"
          ></i>
        </button>

        <div
          class="mb-4 w-full xl:p-2 hidden absolute right-0 top-12 origin-top-left bg-white z-30 rounded-xl xl:w-40 grid gap-2 overflow-hidden"
          role="menu"
          aria-orientation="vertical"
          aria-labelledby="user-menu-button"
          id="account_options"
        >
          <a
            href="{% url 'dash_profile' user.id %}"
            class="px-3 py-2 flex text-sm text-gray-700 hover:text-black hover:bg-yellow-200 xl:rounded-full w-full"
          >
            <i class="fa-solid fa-user xl:mr-2 text-sm"></i>
            <span class="hidden xl:inline">Mon Profile</span>
          </a>

          <a
            id="logout-link"
            hx-boost="false"
            href="{% url 'account_logout' %}"
            class="px-3 py-2 flex text-sm text-red-700 hover:bg-red-700 hover:text-white xl:rounded-full w-full"
          >
            <i class="fa-solid fa-right-from-bracket xl:mr-2 text-sm"></i>
            <span class="hidden xl:inline">Deconnexion</span>
          </a>
        </div>
      </div>
    </div>
  </ul>
</nav>

<script>
  document
    .getElementById("logout-link")
    .addEventListener("click", function (event) {
      event.preventDefault();
      if (confirm("Voulez vous vraiment vous deconnecter?")) {
        window.location.href = this.href;
      }
    });

  function toggleNav(e) {
    e.name === "nav"
      ? ((e.name = "close"), navlinks.classList.remove("hidden"))
      : ((e.name = "nav"), navlinks.classList.add("hidden"));
  }

  function toggleOptions(e, div_id) {
    const allDropdowns = document.querySelectorAll("[id$='_options']");
    const allCarets = document.querySelectorAll("[id$='_caret']");

    // Close all other dropdowns
    allDropdowns.forEach((dropdown) => {
      if (dropdown.id !== div_id) {
        dropdown.classList.add("hidden");
      }
    });

    // Reset all carets
    allCarets.forEach((caret) => {
      if (caret.id !== `${div_id}_caret`) {
        caret.classList.remove("rotate-180");
      }
    });

    const options = document.getElementById(div_id);
    const div_caret = document.getElementById(`${div_id}_caret`);

    if (e.name === "optionsBtn") {
      e.name = "close";
      options.classList.remove("hidden");
      div_caret.classList.add("rotate-180");
    } else {
      e.name = "optionsBtn";
      options.classList.add("hidden");
      div_caret.classList.remove("rotate-180");
    }
  }

  window.addEventListener("mouseup", function (event) {
    const allDropdowns = document.querySelectorAll("[id$='_options']");
    const allButtons = document.querySelectorAll("[name='close']");

    allDropdowns.forEach((dropdown) => {
      if (!dropdown.contains(event.target)) {
        dropdown.classList.add("hidden");
      }
    });

    allButtons.forEach((button) => {
      if (!button.contains(event.target)) {
        button.name = "optionsBtn";
        const caret = document.getElementById(
          `${button.id.replace("Btn", "")}_caret`
        );
        if (caret) {
          caret.classList.remove("rotate-180");
        }
      }
    });

    if (
      !navlinks.contains(event.target) &&
      !document.querySelector('[name="nav"]').contains(event.target)
    ) {
      navlinks.classList.add("hidden");
      document.querySelector('[name="nav"]').name = "nav";
    }
  });
</script>
